<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>EMS â€¢ Ø­Ø¶ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen">

<!-- â–‘â–‘â–‘ Ø´Ø±ÙŠØ· Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„ØºØ© â–‘â–‘â–‘ -->
<div id="langSwitcher" class="fixed top-3 left-3 z-50 flex gap-2">
  <button data-lang="ar" class="lang-btn bg-gray-300 px-2 py-1 rounded hover:bg-gray-400">Ø¹Ø±Ø¨ÙŠ</button>
  <button data-lang="he" class="lang-btn bg-gray-300 px-2 py-1 rounded hover:bg-gray-400">×¢×‘×¨×™×ª</button>
</div>

<!-- â–‘â–‘ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ â–‘â–‘ -->
<section id="loginPage" class="flex flex-col items-center justify-center min-h-screen space-y-6">
  <div class="w-full max-w-sm bg-white rounded-xl shadow-md p-8 space-y-6">
    <div class="text-center space-y-2">
      <img src="https://upload.wikimedia.org/wikipedia/commons/9/94/Ems_Logo.png" alt="EMS Logo" class="mx-auto w-20">
      <h1 id="loginTitle" class="text-2xl font-bold text-gray-800">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h1>
      <p id="singleUserNote" class="text-sm text-gray-500">Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·</p>
    </div>

    <form id="loginForm" class="space-y-4">
      <div>
        <label id="usernameLabel" class="block text-sm mb-1 text-gray-700">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
        <input id="username" type="text" dir="ltr"
               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400"
               placeholder="leo" required>
      </div>

      <div>
        <label id="passwordLabel" class="block text-sm mb-1 text-gray-700">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <input id="password" type="password" dir="ltr"
               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400"
               placeholder="â—â—â—â—â—â—â—â—" required>
      </div>

      <button id="loginButton" type="submit"
              class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700">
        ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
      </button>
      <p id="loginError" class="hidden text-center text-red-600 text-sm mt-2">Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©</p>
    </form>
  </div>
</section>

<!-- â–‘â–‘ ØµÙØ­Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (ØªÙØ®ÙÙ‰ Ø¥Ù„Ù‰ Ø£Ù† ÙŠÙØ³Ø¬Ù‘ÙÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„) â–‘â–‘ -->
<section id="appPage" class="hidden">
  <div class="max-w-4xl mx-auto p-6 space-y-6">

    <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
    <div class="text-center">
      <img src="https://upload.wikimedia.org/wikipedia/commons/9/94/Ems_Logo.png" alt="EMS Logo" class="mx-auto w-24 mb-4">
      <h1 id="appTitle" class="text-3xl font-bold text-gray-800">Ø³Ø¬Ù„ Ø­Ø¶ÙˆØ± Ù„Ø§Ø¹Ø¨ÙŠ EMS</h1>
    </div>

    <!-- Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« -->
    <div class="text-center">
      <input id="searchInput" type="text" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù„Ø§Ø¹Ø¨..."
             class="w-full max-w-md border border-gray-300 rounded-md p-2 text-center shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400">
    </div>

    <!-- Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨ -->
    <div class="text-center">
      <button id="addBtn" class="bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700">
        â• Ø£Ø¶Ù Ù„Ø§Ø¹Ø¨ Ø¬Ø¯ÙŠØ¯
      </button>
    </div>

    <!-- Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† -->
    <div id="playersContainer" class="space-y-6"></div>
  </div>
</section>

<!-- â–‘â–‘ Ø§Ù„ØªØ±Ø¬Ù…Ø§Øª ÙˆØ§Ù„Ù„ØºØ© â–‘â–‘ -->
<script>
const translations = {
  ar: {
    loginTitle: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„",
    singleUserNote: "Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·",
    usernameLabel: "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",
    passwordLabel: "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
    loginButton: "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„",
    loginError: "Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©",
    appTitle: "Ø³Ø¬Ù„ Ø­Ø¶ÙˆØ± Ù„Ø§Ø¹Ø¨ÙŠ EMS",
    searchPlaceholder: "ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù„Ø§Ø¹Ø¨...",
    addPlayerButton: "â• Ø£Ø¶Ù Ù„Ø§Ø¹Ø¨ Ø¬Ø¯ÙŠØ¯",
    playerCardTitle: "Ù„Ø§Ø¹Ø¨ EMS",
    deletePlayer: "ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù„Ø§Ø¹Ø¨",
    playerNameLabel: "Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨",
    playerPlaceholder: "Ù…Ø«Ù„Ø§Ù‹: Ø£Ø­Ù…Ø¯",
    subscriptionLabel: "Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ",
    chooseSubscription: "Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ",
    subscriptionTrial: "1 ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯ - 50 Ø´ÙŠÙƒÙ„ (ØªØ¬Ø±Ø¨Ø©)",
    subscription15: "15 ØªÙ…Ø±ÙŠÙ† - 1500 Ø´ÙŠÙƒÙ„",
    subscription35: "35 ØªÙ…Ø±ÙŠÙ† - 3500 Ø´ÙŠÙƒÙ„",
    subscription50: "50 ØªÙ…Ø±ÙŠÙ† - 4000 Ø´ÙŠÙƒÙ„",
    subscriptionOther: "Ø£Ø®Ø±Ù‰ (Ø£Ø¯Ø®Ù„ ÙŠØ¯ÙˆÙŠÙ‹Ø§)",
    otherDetailsPlaceholder: "Ø£Ø¯Ø®Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ",
    dateLabel: "ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ…Ø±ÙŠÙ†",
    timeLabel: "ÙˆÙ‚Øª Ø§Ù„ØªÙ…Ø±ÙŠÙ†",
    addDateButton: "â• Ø£Ø¶Ù Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª",
    attendanceDatesTitle: "ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¶ÙˆØ±:",
    trialAttendanceText: "1 ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯ - 50 Ø´ÙŠÙƒÙ„ (ØªØ¬Ø±Ø¨Ø©)",
    atTime: "Ø§Ù„Ø³Ø§Ø¹Ø©",
    came: "âœ… Ø£ØªÙ‰",
    notCame: "âŒ Ù„Ù… ÙŠØ£ØªÙ",
    deleteTraining: "ğŸ—‘ï¸ Ø­Ø°Ù",
    deleteTrainingConfirm: "Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªÙ…Ø±ÙŠÙ†ØŸ",
    deletePlayerConfirm: "Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù„Ø§Ø¹Ø¨ØŸ"
  },
  he: {
    loginTitle: "×”×ª×—×‘×¨×•×ª",
    singleUserNote: "××©×ª××© ××—×“ ×‘×œ×‘×“",
    usernameLabel: "×©× ××©×ª××©",
    passwordLabel: "×¡×™×¡××”",
    loginButton: "×”×ª×—×‘×¨",
    loginError: "×¤×¨×˜×™× ×©×’×•×™×™×",
    appTitle: "×¨×™×©×•× × ×•×›×—×•×ª ×©×—×§× ×™ EMS",
    searchPlaceholder: "ğŸ” ×—×¤×© ×©×—×§×Ÿ...",
    addPlayerButton: "â• ×”×•×¡×£ ×©×—×§×Ÿ ×—×“×©",
    playerCardTitle: "×©×—×§×Ÿ EMS",
    deletePlayer: "ğŸ—‘ï¸ ××—×§ ×©×—×§×Ÿ",
    playerNameLabel: "×©× ×”×©×—×§×Ÿ",
    playerPlaceholder: "×œ×“×•×’××”: ××—××“",
    subscriptionLabel: "×¡×•×’ ×× ×•×™",
    chooseSubscription: "×‘×—×¨ ×¡×•×’ ×× ×•×™",
    subscriptionTrial: "×™×•× ××—×“ - 50 â‚ª (× ×™×¡×™×•×Ÿ)",
    subscription15: "15 ××™××•× ×™× - 1500 â‚ª",
    subscription35: "35 ××™××•× ×™× - 3500 â‚ª",
    subscription50: "50 ××™××•× ×™× - 4000 â‚ª",
    subscriptionOther: "××—×¨ (×”×–×Ÿ ×™×“× ×™×ª)",
    otherDetailsPlaceholder: "×”×–×Ÿ ×¤×¨×˜×™ ×× ×•×™",
    dateLabel: "×ª××¨×™×š ××™××•×Ÿ",
    timeLabel: "×©×¢×ª ××™××•×Ÿ",
    addDateButton: "â• ×”×•×¡×£ ×ª××¨×™×š ×•×©×¢×”",
    attendanceDatesTitle: "×ª××¨×™×›×™ × ×•×›×—×•×ª:",
    trialAttendanceText: "×™×•× ××—×“ - 50 â‚ª (× ×™×¡×™×•×Ÿ)",
    atTime: "×‘×©×¢×”",
    came: "âœ… ×”×’×™×¢",
    notCame: "âŒ ×œ× ×”×’×™×¢",
    deleteTraining: "ğŸ—‘ï¸ ××—×§",
    deleteTrainingConfirm: "×œ××—×•×§ ××ª ×”××™××•×Ÿ ×”×–×”?",
    deletePlayerConfirm: "×œ××—×•×§ ××ª ×”×©×—×§×Ÿ ×”×–×”?"
  }
};

const days = {
  ar: ["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø§Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"],
  he: ["×™×•×Â ××³","×™×•×Â ×‘×³","×™×•×Â ×’×³","×™×•×Â ×“×³","×™×•×Â ×”×³","×™×•×Â ×•×³","×©×‘×ª"]
};

let currentLang = localStorage.getItem("emsLang") || "ar";
function t(k){ return translations[currentLang][k] || k; }
document.documentElement.lang = currentLang;
document.documentElement.dir  = "rtl";

/* ØªÙ…ÙŠÙŠØ² Ø²Ø± Ø§Ù„Ù„ØºØ© Ø§Ù„Ø­Ø§Ù„ÙŠ */
function highlightLangButtons(){
  document.querySelectorAll(".lang-btn").forEach(btn=>{
    const active = btn.dataset.lang === currentLang;
    btn.classList.toggle("bg-blue-600", active);
    btn.classList.toggle("text-white", active);
  });
}

/* ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ© */
document.addEventListener("DOMContentLoaded", ()=>{
  document.querySelectorAll(".lang-btn").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const sel = btn.dataset.lang;
      if (sel !== currentLang){
        localStorage.setItem("emsLang", sel);
        location.reload();
      }
    });
  });
  highlightLangButtons();
});
</script>

<!-- â–‘â–‘ Ù…Ù†Ø·Ù‚ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ â–‘â–‘ -->
<script>
document.addEventListener("DOMContentLoaded", () => {

  /* Ø¹Ù†Ø§ØµØ± Ø£Ø³Ø§Ø³ÙŠØ© */
  const loginPage = document.getElementById("loginPage");
  const appPage   = document.getElementById("appPage");
  const loginForm = document.getElementById("loginForm");
  const loginErr  = document.getElementById("loginError");

  /* ØªØ±Ø¬Ù…Ø© ÙˆØ§Ø¬Ù‡Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
  function updateLoginTexts(){
    document.getElementById("loginTitle").textContent    = t("loginTitle");
    document.getElementById("singleUserNote").textContent= t("singleUserNote");
    document.getElementById("usernameLabel").textContent = t("usernameLabel");
    document.getElementById("passwordLabel").textContent = t("passwordLabel");
    document.getElementById("loginButton").textContent   = t("loginButton");
    loginErr.textContent = t("loginError");
  }
  updateLoginTexts();

  /* Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø³Ø¬Ù‘ÙÙ„ Ø¯Ø®ÙˆÙ„ Ø³Ø§Ø¨Ù‚Ù‹Ø§ */
  if (sessionStorage.getItem("loggedIn") === "true") {
    loginPage.classList.add("hidden");
    appPage.classList.remove("hidden");
    updateAppTexts();               // â† ØªØ¹Ø±ÙŠØ¨ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
  }

  /* Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ */
  loginForm.addEventListener("submit", (e) => {
    e.preventDefault();
    const u = document.getElementById("username").value.trim();
    const p = document.getElementById("password").value;
    if (u === "leo" && p === "m22558800") {
      sessionStorage.setItem("loggedIn","true");
      loginErr.classList.add("hidden");
      loginPage.classList.add("hidden");
      appPage.classList.remove("hidden");
      updateAppTexts();
    } else {
      loginErr.classList.remove("hidden");
    }
  });
});
</script>

<!-- â–‘â–‘ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚: Ø³Ø¬Ù„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† â–‘â–‘ -->
<script>
/* Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªØ®Ø²ÙŠÙ† */
const STORAGE_KEY = "emsPlayers";

/* Ø¹Ù†Ø§ØµØ± Ø«Ø§Ø¨ØªØ© */
const playersContainer = document.getElementById("playersContainer");
const searchInput      = document.getElementById("searchInput");
const addBtn           = document.getElementById("addBtn");
const appTitle         = document.getElementById("appTitle");

/* Ù†ØµÙˆØµ Ø«Ø§Ø¨ØªØ© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ */
function updateAppTexts(){
  appTitle.textContent             = t("appTitle");
  searchInput.placeholder          = t("searchPlaceholder");
  addBtn.textContent               = t("addPlayerButton");
}

/* --- Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© --- */
function today(){ return new Date().toISOString().split("T")[0]; }
function formatDateWithDay(d){
  const dt = new Date(d);
  return `${d} - ${days[currentLang][dt.getDay()]}`;
}

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† */
function loadFromStorage(){
  try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
  catch{ return []; }
}
function saveToStorage(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(players));
}

/* ØªØ±Ø­ÙŠÙ„ Ù‚ÙŠÙ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
function migrateSubscriptionType(v){
  if (["1 ÙŠÙˆÙ… - 50 Ø´ÙŠÙƒÙ„ ØªØ¬Ø±Ø¨Ø©","×™×•× ××—×“ - 50 â‚ª (× ×™×¡×™×•×Ÿ)","trial"].includes(v)) return "trial";
  if (["15 ØªÙ…Ø±ÙŠÙ† - 1500 Ø´ÙŠÙƒÙ„","15 ××™××•× ×™× - 1500 â‚ª","15"].includes(v))       return "15";
  if (["35 ØªÙ…Ø±ÙŠÙ† - 3500 Ø´ÙŠÙƒÙ„","35 ××™××•× ×™× - 3500 â‚ª","35"].includes(v))       return "35";
  if (["50 ØªÙ…Ø±ÙŠÙ† - 4000 Ø´ÙŠÙƒÙ„","50 ××™××•× ×™× - 4000 â‚ª","50"].includes(v))       return "50";
  return v;
}

/* Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ù‘Ø© */
let players = loadFromStorage();
players.forEach(p=>{ p.subscriptionType = migrateSubscriptionType(p.subscriptionType||""); });

/* Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ù„Ø§Ø¹Ø¨ */
function renderPlayerCard(player){
  const card = document.createElement("div");
  card.className = "bg-white p-6 rounded-xl shadow-md space-y-4 border border-gray-200";
  card.dataset.id = player.id;

  card.innerHTML = `
    <div class="flex justify-between items-center">
      <h2 class="text-lg font-bold text-gray-700">${t("playerCardTitle")}</h2>
      <button class="delete-player text-red-600 hover:text-red-800 text-sm">${t("deletePlayer")}</button>
    </div>

    <div>
      <label class="block text-sm text-gray-700 mb-1">${t("playerNameLabel")}</label>
      <input type="text" class="player-name w-full p-2 border border-gray-300 rounded-md"
             placeholder="${t("playerPlaceholder")}" value="${player.name||''}" required>
    </div>

    <div>
      <label class="block text-sm text-gray-700 mb-1">${t("subscriptionLabel")}</label>
      <select class="subscription-select w-full p-2 border border-gray-300 rounded-md">
        <option value="">${t("chooseSubscription")}</option>
        <option value="trial">${t("subscriptionTrial")}</option>
        <option value="15">${t("subscription15")}</option>
        <option value="35">${t("subscription35")}</option>
        <option value="50">${t("subscription50")}</option>
        <option value="other">${t("subscriptionOther")}</option>
      </select>
      <textarea class="subscription-other w-full h-20 mt-2 border border-gray-300 rounded-md p-2 text-sm ${player.subscriptionType==='other'?'':'hidden'}"
        placeholder="${t("otherDetailsPlaceholder")}">${player.subscriptionOther||''}</textarea>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
      <div>
        <label class="block text-sm text-gray-700 mb-1">${t("dateLabel")}</label>
        <input type="date" class="date-input border border-gray-300 rounded-md p-2 w-full" value="${today()}">
      </div>
      <div>
        <label class="block text-sm text-gray-700 mb-1">${t("timeLabel")}</label>
        <input type="time" class="time-input border border-gray-300 rounded-md p-2 w-full">
      </div>
      <div class="pt-6 md:pt-0">
        <button type="button" class="add-date bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 w-full">
          ${t("addDateButton")}
        </button>
      </div>
    </div>

    <div>
      <h3 class="font-semibold text-gray-700 mb-2">${t("attendanceDatesTitle")}</h3>
      <ul class="dates-list pr-2 text-sm text-gray-800 space-y-2"></ul>
    </div>
  `;

  /* Ù…Ø±Ø§Ø¬Ø¹ */
  const nameInput   = card.querySelector(".player-name");
  const subSelect   = card.querySelector(".subscription-select");
  const subOtherBox = card.querySelector(".subscription-other");
  const addDateBtn  = card.querySelector(".add-date");
  const dateInput   = card.querySelector(".date-input");
  const timeInput   = card.querySelector(".time-input");
  const datesUL     = card.querySelector(".dates-list");

  subSelect.value = player.subscriptionType || "";

  /* Ø­Ø¶ÙˆØ± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ø®ÙŠØ§Ø± Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ§Ø­Ø¯ */
  function ensureTrialAttendance(){
    if (subSelect.value === "trial" && !player.dates.some(d=>d.trial)){
      const trialDate = {
        id: Date.now(),
        date: today(),
        time: "",
        came: true,
        trial: true
      };
      player.dates.push(trialDate);
      appendDateLi(trialDate, datesUL, player);
      saveToStorage();
    }
  }
  ensureTrialAttendance();

  /* ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© */
  if (player.dates && player.dates.length){
    player.dates.forEach(d=> appendDateLi(d, datesUL, player));
  }

  /* Ø£Ø­Ø¯Ø§Ø« */
  nameInput.addEventListener("input", ()=>{
    player.name = nameInput.value.trim();
    saveToStorage();
  });

  subSelect.addEventListener("change", ()=>{
    player.subscriptionType = subSelect.value;
    subOtherBox.classList.toggle("hidden", subSelect.value!=="other");
    ensureTrialAttendance();
    saveToStorage();
  });

  subOtherBox.addEventListener("input", ()=>{
    player.subscriptionOther = subOtherBox.value.trim();
    saveToStorage();
  });

  addDateBtn.addEventListener("click", ()=>{
    if (!dateInput.value || !timeInput.value) return;
    const newDate = { id:Date.now(), date:dateInput.value, time:timeInput.value, came:false };
    player.dates.push(newDate);
    appendDateLi(newDate, datesUL, player);
    dateInput.value = today();
    timeInput.value = "";
    saveToStorage();
  });

  card.querySelector(".delete-player").addEventListener("click", ()=>{
    if (confirm(t("deletePlayerConfirm"))){
      players = players.filter(p=>p.id!==player.id);
      card.remove();
      saveToStorage();
    }
  });

  playersContainer.appendChild(card);
}

/* Ø¹Ù†ØµØ± ØªÙ…Ø±ÙŠÙ† */
function appendDateLi(dateObj, ul, playerRef){
  const li = document.createElement("li");
  li.className = "flex justify-between items-center bg-gray-100 rounded-md px-3 py-2";
  li.dataset.dateId = dateObj.id;

  const txt = document.createElement("span");
  txt.textContent = dateObj.trial
    ? t("trialAttendanceText")
    : `${formatDateWithDay(dateObj.date)} - ${t("atTime")} ${dateObj.time}`;

  const actions = document.createElement("div");
  actions.className = "flex items-center gap-3";

  const statusBtn = document.createElement("button");
  statusBtn.className = "text-sm hover:underline";
  toggleStatusAppearance(statusBtn, dateObj.came);
  statusBtn.addEventListener("click", ()=>{
    dateObj.came = !dateObj.came;
    toggleStatusAppearance(statusBtn, dateObj.came);
    saveToStorage();
  });

  const delBtn = document.createElement("button");
  delBtn.textContent = t("deleteTraining");
  delBtn.className = "text-gray-500 hover:text-red-600 text-sm";
  delBtn.addEventListener("click", ()=>{
    if (confirm(t("deleteTrainingConfirm"))){
      playerRef.dates = playerRef.dates.filter(d=>d.id!==dateObj.id);
      li.remove();
      saveToStorage();
    }
  });

  actions.append(statusBtn, delBtn);
  li.append(txt, actions);
  ul.appendChild(li);
}

function toggleStatusAppearance(btn, came){
  btn.textContent = came ? t("came") : t("notCame");
  btn.classList.toggle("text-green-600", came);
  btn.classList.toggle("text-red-500", !came);
}

/* Ø¥Ø¶Ø§ÙØ© Ù„Ø§Ø¹Ø¨ Ø¬Ø¯ÙŠØ¯ */
addBtn.addEventListener("click", ()=>{
  const newP = { id:Date.now(), name:"", subscriptionType:"", subscriptionOther:"", dates:[] };
  players.push(newP);
  saveToStorage();
  renderPlayerCard(newP);
});

/* Ø§Ù„Ø¨Ø­Ø« */
searchInput.addEventListener("input", function(){
  const q = this.value.toLowerCase();
  document.querySelectorAll("#playersContainer > div").forEach(card=>{
    const p = players.find(pl=>pl.id==card.dataset.id);
    card.style.display = p && (p.name||"").toLowerCase().includes(q) ? "block" : "none";
  });
});

/* Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© */
updateAppTexts();
players.forEach(renderPlayerCard);
</script>
</body>
</html>
