
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ููุชุจุฉ ุงููุงุนุจ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    table { width: 100%; border-collapse: collapse; }
    th, td { text-align: center; padding: 12px; border: 1px solid #e5e7eb; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen p-4">
  <div class="max-w-6xl mx-auto bg-white p-6 rounded-2xl shadow-lg space-y-8">
    <h1 class="text-4xl font-bold text-center text-blue-800">๐ ููู ุงููุงุนุจ</h1>

    <!-- ุจูุงูุงุช ุงููุงุนุจ -->
    <div id="playerInfo" class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700 text-lg"></div>

    <!-- ุณุฌู ุงูุงุดุชุฑุงูุงุช ูุน ุฒุฑ -->
    <div>
      <div class="flex justify-between items-center mb-2">
        <h2 class="text-2xl font-bold text-blue-700">๐๏ธ ุณุฌู ุงูุงุดุชุฑุงูุงุช</h2>
        <button onclick="addSubscription()" class="bg-blue-600 text-white px-4 py-1 rounded hover:bg-blue-700 text-sm">โ ุฅุถุงูุฉ ุงุดุชุฑุงู</button>
      </div>
      <ul id="subscriptionsList" class="list-disc pr-6 text-gray-600 text-base space-y-1"></ul>
    </div>

    <!-- ุงูุชูุฏู -->
    <div id="progress" class="text-center text-xl font-semibold text-green-600"></div>
    <!-- ุฌุฏูู ุงูุชูุงุฑูู -->
    <div>
      <h2 class="text-2xl font-bold text-blue-700 mb-4">๐ ุฌุฏูู ุงูุชูุงุฑูู</h2>
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm border border-gray-300 rounded-xl">
          <thead class="bg-blue-100 text-blue-900">
            <tr>
              <th>ุงูููู</th>
              <th>ุงูุชุงุฑูุฎ</th>
              <th>ุงูููุช</th>
              <th>ููุน ุงูุชูุฑูู</th>
              <th>ุงูุญุถูุฑ</th>
              <th>ุฎูุงุฑุงุช</th>
            </tr>
          </thead>
          <tbody id="weeklyTable"></tbody>
        </table>
      </div>
    </div>

    <!-- ูููุฐุฌ ุฅุถุงูุฉ ุชูุฑูู -->
    <div class="border-t pt-6">
      <h3 class="text-xl font-bold mb-4">โ ุฅุถุงูุฉ ุชูุฑูู</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-medium mb-1">ุงูููู</label>
          <div class="grid grid-cols-2 gap-2">
            <button class="day-btn bg-gray-200 px-3 py-2 rounded hover:bg-blue-300" data-day="ุงูุฃุญุฏ">ุงูุฃุญุฏ</button>
            <button class="day-btn bg-gray-200 px-3 py-2 rounded hover:bg-blue-300" data-day="ุงูุงุซููู">ุงูุงุซููู</button>
            <button class="day-btn bg-gray-200 px-3 py-2 rounded hover:bg-blue-300" data-day="ุงูุซูุงุซุงุก">ุงูุซูุงุซุงุก</button>
            <button class="day-btn bg-gray-200 px-3 py-2 rounded hover:bg-blue-300" data-day="ุงูุฃุฑุจุนุงุก">ุงูุฃุฑุจุนุงุก</button>
            <button class="day-btn bg-gray-200 px-3 py-2 rounded hover:bg-blue-300" data-day="ุงูุฎููุณ">ุงูุฎููุณ</button>
            <button class="day-btn bg-gray-200 px-3 py-2 rounded hover:bg-blue-300" data-day="ุงูุฌูุนุฉ">ุงูุฌูุนุฉ</button>
            <button class="day-btn bg-gray-200 px-3 py-2 rounded hover:bg-blue-300" data-day="ุงูุณุจุช">ุงูุณุจุช</button>
          </div>
        </div>

        <input id="dateInput" type="date" class="p-2 border rounded">
        <input id="timeInput" type="time" class="p-2 border rounded">

        <select id="typeInput" class="p-2 border rounded">
          <option value="">ููุน ุงูุชูุฑูู</option>
          <option value="ืืืืื ืืื">ืืืืื ืืื</option>
          <option value="ืืืืื ืจืืฉืื 50 ืฉื">ืืืืื ืจืืฉืื 50 ืฉื</option>
          <option value="ืืืืื ืืืฉื">ืืืืื ืืืฉื</option>
        </select>

        <label class="flex items-center gap-2">
          <input type="checkbox" id="cameInput">
          <span>โ ุฃุชู</span>
        </label>
      </div>
      <button id="addTraining" class="mt-4 bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">ุญูุธ ุงูุชูุฑูู</button>
    </div>

    <a href="index.html" class="block text-center text-blue-600 hover:underline">โฌ๏ธ ุงูุนูุฏุฉ</a>
  </div>
<script>
  const playerId = new URLSearchParams(location.search).get("id");
  const players = JSON.parse(localStorage.getItem("players") || "[]");
  const archivedPlayers = JSON.parse(localStorage.getItem("archivedPlayers") || "[]");

  let player = players.find(p => p.id == playerId) || archivedPlayers.find(p => p.id == playerId);
  if (!player) {
    document.body.innerHTML = '<p class="text-red-600 text-center text-xl mt-10">โ ุงููุงุนุจ ุบูุฑ ููุฌูุฏ ูู ุงูุจูุงูุงุช.</p>';
    throw new Error("Player not found");
  }

  player.subscriptions = player.subscriptions || [];
  player.attendance = player.attendance || [];

  const playerInfo = document.getElementById("playerInfo");
  const subsList = document.getElementById("subscriptionsList");
  const progress = document.getElementById("progress");
  const weeklyTable = document.getElementById("weeklyTable");

  const dayInputButtons = document.querySelectorAll(".day-btn");
  const dateInput = document.getElementById("dateInput");
  const timeInput = document.getElementById("timeInput");
  const typeInput = document.getElementById("typeInput");
  const cameInput = document.getElementById("cameInput");

  let selectedDay = "";

  dayInputButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      selectedDay = btn.dataset.day;
      dayInputButtons.forEach(b => b.classList.remove("bg-blue-500", "text-white"));
      btn.classList.add("bg-blue-500", "text-white");

      const dayMap = {'ุงูุฃุญุฏ': 0, 'ุงูุงุซููู': 1, 'ุงูุซูุงุซุงุก': 2, 'ุงูุฃุฑุจุนุงุก': 3, 'ุงูุฎููุณ': 4, 'ุงูุฌูุนุฉ': 5, 'ุงูุณุจุช': 6};
      const today = new Date();
      const targetIndex = dayMap[selectedDay];
      let diff = (targetIndex - today.getDay() + 7) % 7;
      if (diff < 2) diff += 7;
      const targetDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() + diff);
      dateInput.value = targetDate.toISOString().split("T")[0];
    });
  });

  function save() {
    localStorage.setItem("players", JSON.stringify(players));
  }

  function getSubscriptionLabel(value) {
    switch (value) {
      case "15": return "15 ุชูุฑูู - 1500 ุดููู";
      case "35": return "35 ุชูุฑูู - 3000 ุดููู";
      case "50": return "50 ุชูุฑูู - 4000 ุดููู";
      default: return "ุบูุฑ ูุนุฑูู";
    }
  }

  function showInfo() {
    playerInfo.innerHTML = `
      <div>๐ค ุงูุงุณู: ${player.name || "ุบูุฑ ูุนุฑูู"}</div>
      <div>๐ ุงููุงุชู: ${player.phone || "-"}</div>
      <div>๐ ุงูุทูู: ${player.height || "-"} ุณู</div>
      <div>โ๏ธ ุงููุฒู: ${player.weight || "-"} ูุบ</div>
      <div>๐ ุงูุนูุฑ: ${player.age || "-"}</div>
    `;

    subsList.innerHTML = `
      ${player.subscription ? `
        <li class="flex justify-between items-center text-gray-700">
          <span>๐ ุงูุงุดุชุฑุงู ุงูุฃููู: ${getSubscriptionLabel(player.subscription)}</span>
          <button onclick="deletePrimarySubscription()" class="text-red-600 hover:underline text-sm">๐๏ธ ุญุฐู</button>
        </li>` : ""
    }
    ${player.subscriptions.map((sub, i) => `
      <li class="flex justify-between items-center">
        <span>${sub.date} - ${getSubscriptionLabel(sub.type)}</span>
        <button onclick="deleteSubscription(${i})" class="text-red-500 text-sm hover:underline">๐๏ธ ุญุฐู</button>
      </li>
    `).join("")}
    `;

    updateProgress();
  }

  function updateProgress() {
    const total = parseInt(player.subscriptions.at(-1)?.type || player.subscription || "0");
    const attended = player.attendance.filter(a => a.came).length;
    progress.textContent = total ? `โ ุชู ${attended} ูู ${total} ุชูุฑูู` : "๐ ูุง ููุฌุฏ ุงุดุชุฑุงู ููุนู";
  }

  function addSubscription() {
    const choice = prompt("ุงุฎุชุฑ ููุน ุงูุงุดุชุฑุงู:
15 - 1500 ุดููู
35 - 3000 ุดููู
50 - 4000 ุดููู");
    if (["15", "35", "50"].includes(choice)) {
      player.subscriptions.push({ type: choice, date: new Date().toISOString().split("T")[0] });
      save();
      showInfo();
    } else {
      alert("โ ูุฑุฌู ุงุฎุชูุงุฑ 15 ุฃู 35 ุฃู 50 ููุท");
    }
  }

  function deleteSubscription(index) {
    if (confirm("ูู ุชุฑูุฏ ุญุฐู ูุฐุง ุงูุงุดุชุฑุงูุ")) {
      player.subscriptions.splice(index, 1);
      save();
      showInfo();
    }
  }

  function deletePrimarySubscription() {
    if (confirm("ูู ุชุฑูุฏ ุญุฐู ุงูุงุดุชุฑุงู ุงูุฃูููุ")) {
      delete player.subscription;
      save();
      showInfo();
    }
  }

  function getTypeColor(type) {
    if (type === "ืืืืื ืืื") return "bg-blue-50 text-blue-700";
    if (type === "ืืืืื ืจืืฉืื 50 ืฉื") return "bg-yellow-50 text-yellow-700";
    if (type === "ืืืืื ืืืฉื") return "bg-green-50 text-green-700";
    return "bg-gray-100 text-gray-700";
  }

  function showTable() {
    weeklyTable.innerHTML = "";
    player.attendance.forEach((a, i) => {
      const row = document.createElement("tr");
      row.className = getTypeColor(a.type);
      row.innerHTML = `
        <td>${a.day}</td>
        <td>${a.date}</td>
        <td>${a.time}</td>
        <td>${a.type}</td>
        <td>${a.came ? "โ" : "โ"}</td>
        <td>
          <button onclick="toggle(${i})" class="text-blue-600 hover:underline">ุชุจุฏูู</button>
          <button onclick="remove(${i})" class="text-red-600 hover:underline ml-2">๐๏ธ ุญุฐู</button>
        </td>
      `;
      weeklyTable.appendChild(row);
    });
  }

  document.getElementById("addTraining").onclick = () => {
    if (!dateInput.value || !timeInput.value || !typeInput.value) {
      alert("ูุฑุฌู ุชุนุจุฆุฉ ุงูุชุงุฑูุฎ ูุงูููุช ูููุน ุงูุชูุฑูู.");
      return;
    }

    let dayName = selectedDay;
    if (!dayName) {
      const date = new Date(dateInput.value);
      const dayNames = ['ุงูุฃุญุฏ', 'ุงูุงุซููู', 'ุงูุซูุงุซุงุก', 'ุงูุฃุฑุจุนุงุก', 'ุงูุฎููุณ', 'ุงูุฌูุนุฉ', 'ุงูุณุจุช'];
      dayName = dayNames[date.getDay()];
    }

    player.attendance.push({
      day: dayName,
      date: dateInput.value,
      time: timeInput.value,
      type: typeInput.value,
      came: cameInput.checked
    });

    save();
    showInfo();
    showTable();
    selectedDay = "";
    dayInputButtons.forEach(b => b.classList.remove("bg-blue-500", "text-white"));
    dateInput.value = "";
    timeInput.value = "";
    typeInput.value = "";
    cameInput.checked = false;
  };

  window.toggle = i => {
    player.attendance[i].came = !player.attendance[i].came;
    save();
    showInfo();
    showTable();
  };

  window.remove = i => {
    if (confirm("ูู ุชุฑูุฏ ุญุฐู ูุฐุง ุงูุชูุฑููุ")) {
      player.attendance.splice(i, 1);
      save();
      showInfo();
      showTable();
    }
  };

  showInfo();
  showTable();
</script>
</body>
</html>
